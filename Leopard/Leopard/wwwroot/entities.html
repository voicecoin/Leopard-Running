<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="description" content="最简易的聊天机器人设计及协作平台，十分钟轻松制作我的聊天机器人！集成深度神经网络、知识图谱、和自然语言处理的超强技术" />
  <title>词库</title>
  <link rel="stylesheet" href="css/bootstrap.min.css" >
  <link rel="stylesheet" type="text/css" href="css/font-awesome.css">
  <link rel="stylesheet" type="text/css" href="css/robot.css">
  <link rel="stylesheet" type="text/css" href="css/ui-box.css" />
  <link rel="stylesheet" type="text/css" href="css/jquery.tagsinput.css" />

   <link rel="stylesheet" href="css/jquery-ui.css" >
   <link rel="stylesheet" type="text/css" href="css/page.css" />
     <link rel="stylesheet" href="css/scrollstyle.css" >
  <style>
    .input-lg{padding:0;font-size:14px;height: auto;}
    @media screen and (max-width: 750px) {
  	.ui_side{width:16%;height: 100%;overflow: hidden;}
  	.ui_side_list_li{margin-bottom: 7px;}
    .input-lg{padding:0;font-size:14px;height: auto;}
	.ui_mid_main{padding-top:15px;}
  	.ui_mid{width:84%;height:100%;}
  	.ui_right{display: none;}
  	.ui_mid_01_left{width:70%;}
  	.ui_mid_03{width:70%;}
  	.ui_mid_main{padding-top:25px;}
  	.ui_div{font-size:12px;}
  	.ui_div span{padding-right:2px;padding-left:3px;}
  	.ui_mid_main img{padding-right:3px;}
  	.ui_side_top{padding-top:10px;padding-bottom:8px;}
	}
.btn-group a:link{
	color: #fff;
	text-decoration: none;
}
.btn-group a:active{
	color: #fff;
	text-decoration: none;
}
.btn-group a:hover{
	color: #fff;
	text-decoration: none;
}
.btn-group a:visited{
	color: #fff;
	text-decoration: none;
}


.select-entity-menu {
    /* display: none; */
    position: absolute;
    top: 50%;
    width: 300px;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    background-color: #fff;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
    background-clip: padding-box;
    left: 50%;
    z-index: 1002;
}
.select-entity-menu .select-head {
    padding: 8px 0;
    border-bottom: 1px solid rgba(0,0,0,0.12);
}
.filterParam {
    display: block;
    width: 100%;
    padding: 0 16px;
    height: 40px;
    line-height: 40px;
}
.menu-list {
    padding: 8px 0;
    min-height: 96px;
    max-height: 304px;
    overflow-y: auto;
}
.add-box {
    height: 48px;
    padding: 15px 0;
    float: right;
}
.menu-list li a {
    display: block;
    height: 48px;
    line-height: 48px;
    padding: 0 16px;
}
.create-new .plus {
    vertical-align: middle;
}
  </style>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script src="js/jquery.cookie.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script type="text/javascript" src="js/jquery.z-pager.js"></script>
  <script src="js/jquery.tagsinput.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/check.js"></script>
  <script src="js/main.js"></script>
<script>

var entity=null;
var agentId=null;
var entityId=null;
var showModel=1;
var totalIndex=0;
function delEntity(id){
     $.ajax({
   			url: 'http://api.yaya.ai/v1/Entities/'+id,
   			type: "DELETE",
   			datType: "JSON",
   			contentType: "application/json",
   			data: {},
   			success: function () {
   			    s_tip("删除成功",'ok');
				initPage();
   			},error: function(e) {
			   s_tip(e,'fail');
 	    	}
   	});
}

function showEntity(id){
	showModel=2;
	entityId=id;
	$.get("entityeditor.html", function(data) {
        $('.ui_mid').html(data);
        loadEntity(entityId);
    }); 
}

function cacheEntityEntries(data){
	var currentEntries=entity.entries;
	for(var j=0;j<data.length;j++){
		var exsitFlag=false;
		var t=data[j];
		if(currentEntries.length>0){
			for(var i=0;i<currentEntries.length;i++){
				if(t.id==currentEntries[i].id){
					currentEntries[i]=t;
					exsitFlag=true;
					break;
				}
			}
		}
		if(!exsitFlag){
			currentEntries.push(t);
		}
	}

}

function delEntityEntriesFromCache(id){
	var currentEntries=entity.entries;
	for(var i=0;i<currentEntries.length;i++){
		if(id==currentEntries[i].id){
			currentEntries.splice(i,1);
			break;
		}
	}
}

function initEntititesPage(id){
	if(id!=null && id.length>0){
		$("#pageContainer1").show();
		var url="http://api.yaya.ai/v1/EntityEntries/"+id+"/Query";
		$("#pageContainer1").zPager({
			url:url,
			htmlBox: $('#entity-editor'),
			btnShow: false,
			dataRender: function(data){
				initEntityEntries(data);
				updateSynonyms();
			}
		});
	}else{
		$("#pageContainer1").hide();
	}

}

function loadEntity(id){
	//alert(id);
	if(id.length==0){
		entity={};
		entity.id='';
		entity.name='';
		entity.entries=[{id:'',value:'',synonyms:[]},{id:'',value:'',synonyms:[]},{id:'',value:'',synonyms:[]},{id:'',value:'',synonyms:[]},{id:'',value:'',synonyms:[]}];
		initEntity(entity);
	}else{
		 var self=this;
	      $.ajax({
	    	  url: 'http://api.yaya.ai/v1/Entities/'+id,
	    	  type: 'GET',
	    	  data: {},
	    	  success: function(json) {
	    		  self.entity=json;
				  initEntity(self.entity);
				  self.entity.entries=[];
				  initEntititesPage(self.entity.id);
	    	  },error: function(e) {
	    		  self.entity=null;
	    		  s_tip("错误",e);
	    	  }
	    });

	}
	
}

function initEntityEntries(entries){
	$("#entity-editor").empty();

	for(var i=0;i<entries.length;i++){
		totalIndex+=1;
		console.log("index="+(totalIndex));
		addEntry(entries[i],totalIndex);
	}
	entityEventHander();
}

function initEntity(entity){
	 $("#entity_id").val(entity.id);
	 $("#entity-name").val(entity.name);
	 if(entity.isEnum){
		 $(".ng-empty-synonyms").toggleClass("ng-checked",true);
		 $("#synonyms-data").val("1");
		 $(".alert-operation-tip").show();
	 }else{
		 $(".ng-empty-synonyms").removeClass("ng-checked",false);
		 $("#synonyms-data").val("0");
		 $(".alert-operation-tip").hide();
	 }
	
	 if(entity.entries !== undefined  && entity.entries.length>0){
		for(var i=0;i<entity.entries.length;i++){
			addEntry(entity.entries[i],i);
		}
	 }

	 entityEventHander();
}

function entityEventHander(){
	$("#inner-header").off("click").on('click','#save_btn',function(){
		submitEntity();
	});
	
	$("#entity-name").off("blur").on("blur",function(){
		if(entity.id.length>0){
			if($(this).val()!=entity.name && $(this).val().length>0){
				  var data={};
				  data.id=entity.id;
				  data.name=$(this).val();
				  
			      $.ajax({
			    	  url: 'http://api.yaya.ai/v1/Entities/'+entity.id,
			    	  type: 'PUT',
			    	  data: JSON.stringify(data),
			    	  datType: "JSON",
		    		  contentType: "application/json",
			    	  success: function(json) {
			    		  entity.name=$("#entity-name").val();
			    		  //s_tip('','fail');
			    	  },error: function(e) {
			    		  //currentBot=null;
			    		  //s_tip("错误",e);
			    	  }
			    	});
			}
		}

	});
	
	/*$(".realinput").off("blur").on("blur",function(){
		//已有的词库
		if(entity.id.length>0){
			var id=$(this).parent().parent().parent().parent().attr('data-id');
			var jid=$(this).parent().parent().parent().parent().attr('id');
			
			//新增条目
			var data={};
			var t=$("#"+jid).find(".entryname:first").val();
			if(t.length>0){
				data.value=t;
				data.synonyms=[];
				if($("#synonyms-data").val()==1){
					console.log("synonyms-data="+$("#"+jid).find(".tags:first").val());
					data.synonyms=$("#"+jid).find(".tags:first").val().split(',');
				}
				if(id.length==0){
					$.ajax({
				    	  url: 'http://api.yaya.ai/v1/EntityEntries/'+id,
				    	  type: 'POST',
				    	  data: JSON.stringify(data),
				    	  datType: "JSON",
			    		  contentType: "application/json",
				    	  success: function(json) {
				    		  //entity.name=$("#entity-name").val();
				    		  //s_tip('','fail');
				    	  },error: function(e) {
				    		  //currentBot=null;
				    		  //s_tip("错误",e);
				    	  }
				    	});
				}else{
					data.id=id;
					//更新条目
					$.ajax({
				    	  url: 'http://api.yaya.ai/v1/EntityEntries/'+id,
				    	  type: 'PUT',
				    	  data: JSON.stringify(data),
				    	  datType: "JSON",
			    		  contentType: "application/json",
				    	  success: function(json) {
				    		  console.log();
				    	  },error: function(e) {
				    		  //currentBot=null;
				    		  //s_tip("错误",e);
				    	  }
				    });
				}
				
			}
			
			
			
			console.log('entityentityid='+$(this).parent().parent().parent().parent().attr('data-id'));
		}

	});*/

	//校验词条名称
	$('#entity-name').off("input propertychange").on('input propertychange', function () {
        var s = $(this).val();
       	if($.trim(s) != "") {
			if(isNumberOr_Letter(s) == false){
				$(this).css("border-color", "#f76949").next("div").show().find("font").html("实体名称只能包含中文、字母、数字、中划线及下划线");
			}else{
				$(this).css("border-color", "#36A0E1").next("div").hide();
			}
        }else{
        	$(this).css("border-color", "#36A0E1").next("div").hide();
        }
    });
	
	//显示同义词或者不显示
	$(".ng-empty-synonyms").off("click").on('click',function(e){
		e.stopPropagation();
		$(this).toggleClass("ng-checked");
		//定义同义词显示的样式
		$(".entity_from").toggleClass("entity_from_noChk");
		if($(this).hasClass("ng-checked")){
			$("#synonyms-data").val("1");
			$(".alert-operation-tip").show();
			//operare_entity._fnShowStyle();
		}else{
			$("#synonyms-data").val("0");
			$(".alert-operation-tip").hide();
			//$(".entry-value-input").removeAttr("readonly");
		}
		if(entity.id.length>0){
			var newsynony=($("#synonyms-data").val()==1);
			//if(newsynony!=entity.isEnum){
				//entity.isEnum=newsynony;
				var data={};
				data.id=entity.id;
				data.name=$("#entity-name").val();
				data.isEnum=newsynony?"True":"False";
				$.ajax({
					url: 'http://api.yaya.ai/v1/Entities/'+entity.id,
					type: 'PUT',
					data: JSON.stringify(data),
					datType: "JSON",
					contentType: "application/json",
					success: function(json) {
						showEntity(entity.id);
					},error: function(e) {
						//currentBot=null;
						//s_tip("错误",e);
					}
				});
			//}
		}




	});
	
	//隐藏创建词条提示
	$(".alert-operation-tip").off('click', '.close').on('click', '.close',function () {
		$(".alert-operation-tip").hide();
    });
	//条目鼠标移进
	$(".entry").off("mouseenter").on('mouseenter',function(){
		 $(this).find('.ico-item').show();
	});
	
	//条目鼠标移除
	$(".entry").off("mouseleave").on('mouseleave',function(){
		 $(this).find('.ico-item').hide();
	});
	
	//点我编辑
	$("#entity-editor").off('click','.entry').on('click','.entry',function(){
		//如果是新建的
		$("#entity-editor").find(".entry").each(function(){
			$('#tags_'+$(this).attr('id').replace('entry_','')).setEditModel(false);
	    });
		var id=$(this).attr('id');
		//alert(id);
		$("#"+id).css('height','auto');
		var tag_id=$(this).find('.tags:first').attr('id');
		if($("#synonyms-data").val()==1){
			$('#'+tag_id).setEditModel(true);
		}else{
			$('#'+tag_id).setEditModel(false);
		}
		
		if($(this).find('.entryname:first').val().length==0){
			$(this).find('.entryname:first').focus();
		}
		
	});
	
	//关键字输入框失去焦点
	$(".entryname").off('focusout').on('focusout',function(){
		if($(this).val().length>0 && $("#synonyms-data").val()==1){
			var entityId=$(this).parent().parent().attr('id');
			$('#tags_'+entityId.replace('entry_','')).importTags($(this).val());
		}
	});
	
	$('.entryname').off("input propertychange").on('input propertychange', function () {
		if($("#synonyms-data").val()==0 && $(this).val().indexOf('@')>-1){
				var key=$(this).val().substring($(this).val().indexOf('@'),$(this).val().length);
				if(key.length>1){
					key=key.replace('@','');
					setTimeout("autoCompleteEntity('"+$(this).attr('id')+"','"+key+"')",1000);
				}
				
		}
	});
	
	$(".entryname").off('keyup').on('keyup',function(e){
		console.log('keyup');
		if(e.keyCode == 13){
			if($(this).val().length==0){
				s_tip("请输入关键字",'fail');
			}else{
				$(this).parent().parent().find("input:last").focus();
			}
		}
	});

	//删除条目
	$("#entity-editor .del_icon").off('click').on('click',function(){
		console.log('data-id'+$(this).parent().parent().parent().attr('data-id'));
		$(this).parent().parent().parent().remove();
		delEntryEntities($(this).parent().parent().parent().attr('data-id'));
	});

	//新增或修改条目
	$("#entity-editor .upload_icon").off('click').on('click',function(){
		console.log('upload_icon data-id'+$(this).parent().parent().parent().attr('data-id'));

		//已有词库
		if(entity.id.length>0){
			var nowEntry=$(this).parent().parent().parent();
			var entry={};
			var t=nowEntry.find(".entryname:first").val();
			if(t.length>0){
				entry.id=nowEntry.attr('data-id');
				entry.value=t;
				entry.synonyms=[];
				if($("#synonyms-data").val()==1){
					entry.synonyms=nowEntry.find(".tags:first").val().split(',');
				}
			}
			if(entry.id.length==0){
				//新增条目
				$.ajax({
					url: 'http://api.yaya.ai/v1/EntityEntries/'+entity.id,
					type: 'POST',
					datType: "JSON",
					contentType: "application/json",
					data: JSON.stringify(entry),
					success: function(json) {
						$("#pageContainer1").zPager('pageData',$("#pageContainer1"),$("#pageContainer1").find(".current").attr("page-id"));
						s_tip("条目已保存","ok");
					},error: function(e) {
						//self.entity=null;
						s_tip(e,"fail");
					}
				});
			}else{
				//修改条目
				$.ajax({
					url: 'http://api.yaya.ai/v1/EntityEntries/'+entry.id,
					type: 'PUT',
					datType: "JSON",
					contentType: "application/json",
					data: JSON.stringify(entry),
					success: function(json) {
						s_tip("条目已保存","ok");
						$("#pageContainer1").zPager('pageData',$("#pageContainer1"),$("#pageContainer1").find(".current").attr("page-id"));
						//$("#pageContainer1").find(".current").trigger('click');
					},error: function(e) {
						//self.entity=null;
						s_tip(e,"fail");
					}
				});
			}


		}else{
			//新词库不做处理统一保存
		}
		//$(this).parent().parent().parent().remove();
		//delEntryEntities($(this).parent().parent().parent().attr('data-id'));
	});
}

/**
 * 删除指定条目
 * */
function delEntryEntities(id){
	delEntityEntriesFromCache(id);
	$.ajax({
		url: 'http://api.yaya.ai/v1/EntityEntries/'+id,
		type: "DELETE",
		datType: "JSON",
		contentType: "application/json",
		data: {},
		success: function () {

		},error: function(e) {
			//s_tip(e,'fail');
  	  	}
	});
}


/**
 * @出filter
 * */
function autoCompleteEntity(id,key){
    $.ajax({
  	  url: 'http://api.yaya.ai/v1/Entities/'+agentId+'/Query?name='+key,
  	  type: 'GET',
  	  data: {},
  	  success: function(json) {
  		initAutoCompleteDiv(id,json.items);
  	  },error: function(e) {
  		  
  	  }
  	});
}


/**
 * filter点选设置值
 * */
function setValueToInput(id,value){
	//alert("setValueToInput");
	$("#"+id).val(value);
	$(".select-entity-menu").remove();
}

/**
 * 生成filter窗口
 * */
function initAutoCompleteDiv(id,data){
	if(data.length==0){
		return;
	}
	var _left=$("#"+id).offset().left+60;
	var _top=$("#"+id).offset().top;
	var html='<div class="select-entity-menu" style="left: '+_left+'px; top:'+_top+'px;">';
	html+='<ul class="select-menu">';
	html+='<div class="select-head">';
	html+='<input id="filterParam" type="text" placeholder="Filter..." class="filterParam" value="" name=""></div>';
	html+='<ul class="menu-list">';
	for(var i=0;i<data.length;i++){
		html+='<li><a href="javascript:void(0)" class="filterItem" onclick="setValueToInput(\''+id+'\',\''+data[i].name+'\');">'+data[i].name+'</a></li>';
	}
	html+='</ul>';
	html+='<div class="add-box">';
	html+='<a href="javascript:void(0)" onclick="createNewEntity()" id="createNewEntity" class="create-new">';
	html+='<span class="flaticon stroke plus"></span>创建新词库</a>';
	html+='</div>';
	html+='</ul>';
	html+='</div>';
	//$(".ui_mid").append(html);
	$(".select-entity-menu").remove();
	$("body").append(html);
	$(".select-entity-menu").off('click').on('click',function(e){
		var e = e || window.event;
		e.stopPropagation();
	});
	
	$("#filterParam").off("input propertychange").on('input propertychange', function () {
		$(".filterItem").each(function(){
			if($(this).html().indexOf($("#filterParam").val())>-1){
				$(this).show();
			}else{
				$(this).hide();
			}
		});
	});
	$("body").off("click").on('click',function(e){
		$(".select-entity-menu").remove();
	});
}

/**
 * 同义词点选事件处理
 * */
function updateSynonyms(){
	if($("#synonyms-data").val()==1){
		$(".tags").each(function(){
			var id=$(this).attr('id');
			$(this).removeAttr('disabled');
			$("#"+id).setEditModel(true);
		});
	}else{
		$(".tags").each(function(){
			var id=$(this).attr('id');
			console.log("id="+id);
			$("#"+id).importTags('');
			$("#"+id).setEditModel(false);
			$(this).attr('disabled', true);
		 });
	}
}


/**
 * 添加一行
 * */
function addRow(){
	//entity.entries.push({id:'',value:'',synonyms:[]});
	var tmpEntry={id:'',value:'',synonyms:[]};
	totalIndex+=1;
	addEntry(tmpEntry,totalIndex);
	entityEventHander();
}

/**
 * 生成单行条目
 * */
function addEntry(entry,idIndex){
	
	var tagsValue='';
	if(entry.synonyms.length>0){
		for(var j=0;j<entry.synonyms.length;j++){
			tagsValue+=entry.synonyms[j];
			if(j!=entry.synonyms.length-1){
				tagsValue+=',';
			}
		}
	}
	
	var html='';
	
	
	
	html+='<div id="entry_'+idIndex+'" data-id="'+entry.id+'" class="ub entry" style="min-height: 40px;height:auto;margin-bottom: -1px;border: 1px solid #ddd;">';
	
	
	
	
	if(entry.synonyms.length==0 && entry.value.length==0){
		//html+='<div id="entry_'+i+'_new" class="ub ub-ver ub-ac ub-pc" style="width:100%"></div>';
	}
	//html+='<div id="entry_'+i+'_update">';
	html+='<div class="ub ub-ver ub-ac ub-pc" style="width:5%"></div>';
	html+='<div class="ub ub-ver ub-ac ub-pc" style="width:10%">';
	html+='<input id="ui_input_'+idIndex+'" data-auto="0" class="input-lg form-input entryname" type="text" placeholder="添加关键字" value="'+entry.value+'">';
	html+='</div>';
	html+='<div class="ub ub-ver ub-ac ub-pc" style="width:70%">';
	html+='<input id="tags_'+idIndex+'" type="text" class="tags" value="'+tagsValue+'" placeholder="点击这里进入编辑"/>';
	html+='</div>';
	html+='<div class="ub ub-ver ub-ac ub-pc icodiv" style="width:15%">';
	html+='	<a href="javascript:void(0)" class="ico-item no-result"><span class="glyphicon glyphicon-upload upload_icon"></span></a>'
	html+='	<a href="javascript:void(0)" class="ico-item no-result"><span class="glyphicon glyphicon-trash del_icon"></span></a>';
	//html+='</div>';
	html+='</div>';
	html+='</div>';
	
	$("#entity-editor").append(html);
	
	$('#tags_'+idIndex).tagsInput({width:'100%',defaultText:'添加同义词',height:'auto',hide:false,autosize:true});
	$('#tags_'+idIndex).setEditModel(false);
	//$('tags_'+i+'_tagsinput').show();
	//$('tags_'+i+'_tagsinput').hide();
}


function showList(){
	showModel=1;
	$.get("entitylist.html", function(data) {
        $('.ui_mid').html(data);
        $("#createEntity").on('click',function(){
    		//alert("#createEntity");
    		showEntity('');
    	});
		initPage();
    }); 
}



function initPage(){
	var key=$("#search").val();
	if(agentId!=null){
		var url="http://api.yaya.ai/v1/Entities/"+agentId+"/Query";
		if(key!=null && key.length>0){
			url+='?name='+key
		}
		$("#pageContainer").zPager({
			url:url,
			htmlBox: $('.list-group'),
			btnShow: false,
			dataRender: function(data){
				initEntities(data);
		    }
		});
	}
}

/*
 function loadMoreEntities(){
 console.log('pageNo='+pageNo+",pageSize="+pageSize+",totalNum="+totalNum);
 if(pageNo*pageSize>totalNum){

 }else{
 loadEntities($("#search").val(),(pageNo+1));
 }
 }
function loadEntities(key,pno){
	if(agentId!=null){
		var url="http://api.yaya.ai/v1/Entities/"+agentId+"/Query";
		if(key!=null && key.length>0){
			url+='?name='+key+"&page="+pno;
		}else{
			url+='?page='+pno;
		}
		var self=this;
		$.get(url, null,function(json) {
			self.pageNo=json.page;
			self.totalNum=json.total;
			self.pageSize=json.size;
			self.entities=json.items;
	  	    initEntities(self.pageNo>1);
			
		});

	}
	
}
*/
function startSearch(){
	initPage();
}

function initEntities(entities){
	var html='';
	for(var i=0;i<entities.length;i++){
		html+='<li class="list-group-item ng-scope entity" id="'+entities[i].id+'"><a href="javascript:void(0)" class="name ng-binding">'+entities[i].name+'</a>';
		html+='<div class="ico-group right">';
		html+='<a class="ico-item del-icon" style="display:none"  href="javascript:void(0)"><span class="glyphicon glyphicon-trash" entity_id="'+entities[i].id+'"></span></a>';
		html+='</div></li>';
	}

	$(".list-group").html(html);

	$(".entity").off('click').on('click', function() {
		showEntity($(this).attr('id'));
    });
	
	$(".entity").off('mouseenter').on('mouseenter', function() {
		$(this).find(".del-icon").show();
    });
	
	$(".entity").off('mouseleave').on('mouseleave', function() {
		$(this).find(".del-icon").hide();
    });
	
	$(".entity .glyphicon-trash").off('click').on('click',function(event) {
         var id = $(this).attr("entity_id");
         delEntity(id);
         event.stopPropagation();
     });



}

function submitEntity(){
	//alert('submitEntity');
	var data={};
	var apiurl="";
	data.id=$("#entity_id").val();
	if($("#entity_id").val().length==0){
		apiurl='http://api.yaya.ai/v1/Entities/'+agentId;
		//data.id=$("#entity_id").val();
		data.name=$("#entity-name").val();
		if(data.name.length==0){
			s_tip('词库名称不能为空','fail');
			return;
		}
	}else{
		data.entityId=$("#entity_id").val();
	}

	data.entries=[];
	data.isEnum=($("#synonyms-data").val()==1)?"True":"False";
	$("#entity-editor").find(".entry").each(function(){
		var entry={};
		var t=$(this).find(".entryname:first").val();
		if(t.length>0){
			entry.value=t;
			entry.synonyms=[];
			
			if($("#synonyms-data").val()==1){
				entry.synonyms=$(this).find(".tags:first").val().split(',');
			}
			data.entries.push(entry);
		}
    });
	//新增
	if($("#entity_id").val().length==0){
		if(data.entries.length>0)
		{
			data.agentId =agentId;
			$.ajax({
				url: apiurl,
				type: "POST",
				datType: "JSON",
				contentType: "application/json",
				data: JSON.stringify(data),
				success: function (json) {
					s_tip("保存成功",'ok');
				},error: function(e) {
					s_tip(e,'fail');
				}
			});

		}else{
			s_tip('请添加关键字','fail');
		}
	}else{
		//对比name

		//对比同义词checkBox

		//如果同义词有继续对比是否有修改的条目
	}

	
}

$(document).ready(function(){ 
	agentId=getQuery('agentId');
	showList();
	loadLeft();
	$.get("bottest.html", function(data) {
        $('.ui_right').html(data);
    }); 
});

function loadLeft(){
	$.get("left.html", function(data) {
        $('#leftmenu').html(data);
        loadBots();
    }); 
}

function resetAgent(id){
	agentId=id;
	switch(showModel){
	case 1:
		initPage();
		break;
	case 2:
		loadEntity(entityId);;
		break;
	}
}
</script>

</head>

<body style="background:#ffffff;height:auto;width:100%;overflow:hidden;">
<div  style="width:100%;height:auto;overflow:hidden;">
<div id="leftmenu" class="ui_side" >
</div>
<div class="ui_mid">
</div>
<div class="ui_right">
	
</div>

  <div id="dialog-modal" title="会话测试"  style="display:none;">
  <div class="dialog_mian">
	<div class="ui_right_mid">
		<img  src="images/ui_06.jpg" /><span>你好！我是小白</span>
	</div>
	<div class="ui_right_right">
		<span>你好！我是...</span><img  src="images/ui_10.jpg" />
	</div>
	<div class="ui_right_btm1" id="dialog_btm">
		<input class="" type="text" pattern="" placeholder="   输入对话">
		<button type="button">发  送</button>

	</div>
		
  </div>
</div>
</div>








</body>

</html>



